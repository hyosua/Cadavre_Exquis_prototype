var u=Object.defineProperty;var c=(i,e,t)=>e in i?u(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var o=(i,e,t)=>c(i,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();const a={rounds:["nom commun","adjectif","verbe","nom commun","circonstance"],minPlayers:1,maxPlayers:5,players:["Joe","James","Maria","Daniel","Francesco"],colors:["#fca311","#14213d","#7b4db0","#a85f11","#03dac5"]};class p{constructor(e){this.words=[],this.players=e.players||[],this.roundIndex=0,this.playerIndex=0,this.rounds=e.rounds,this.maxWords=this.rounds.length}getState(){const t=this.rounds.length%this.players.length,n=(t-1+this.players.length)%this.players.length;return{playerIndex:t,words:[...this.words],currentRound:this.rounds[this.roundIndex],currentPlayer:this.players[t],previousPlayer:this.players[n],progress:(this.roundIndex*this.players.length+this.playerIndex)/(this.rounds.length*this.players.length)*100,currentRoundIndex:this.roundIndex,maxWords:this.maxWords,wordCount:this.words.length,isCompleted:this.isGameCompleted()}}isGameCompleted(){return this.words.length>=this.maxWords}addWord(e){if(this.isGameCompleted()||!e)return!1;const t=this.words.length,n=t%this.players.length,s={word:e.trim(),type:this.rounds[t],player:this.players[n]};return this.words.push(s),this.roundIndex=this.words.length,this.playerIndex=this.words.length%this.players.length,!0}removeLastWord(){return this.words.length?(this.words.pop(),this.roundIndex=this.words.length,this.playerIndex=this.words.length%this.players.length,!0):!1}reset(){this.roundIndex=0,this.words=[],this.playerIndex=0}}class d{constructor(e,t,n,s,r,l){this.word=e,this.type=t,this.index=n,this.totalWords=s,this.handleRemoveLastWord=r,this.player=l}createLi(){const e=document.createElement("li");return e.textContent="...",e.dataset.type=this.type,e.style.backgroundColor=this.player.color,e.classList.add("enter"),e}createWordType(){const e=document.createElement("span");return e.textContent=this.type,e.classList.add("type"),e}createDelButton(){const e=document.createElement("button");return e.classList.add("actionBtn"),e.textContent="❌",e.addEventListener("click",()=>this.handleRemoveLastWord()),e}createWord(){const e=this.createLi();if(this.createWordType(),this.index==this.totalWords-1){const t=this.createDelButton();e.textContent=this.word,e.append(t)}return e}}class m{constructor(){o(this,"displayMessage",e=>{this.elements.wordInput.value="",this.elements.errorDiv.textContent=e,this.elements.errorDiv.classList.add("active"),setTimeout(()=>this.elements.errorDiv.classList.remove("active"),4e3)});this._onAddWordCallback=null,this._onResetCallback=null,this._onRevealCallback=null,this.elements=this.getElements(),this.word=new d,this._bindEvents()}getElements(){return{inputContainer:document.querySelector(".input-container"),displayPanel:document.getElementById("display"),wordInput:document.getElementById("input"),ulWordlist:document.getElementById("list"),progressDiv:document.querySelector(".progress"),errorDiv:document.querySelector(".error"),countDiv:document.querySelector(".word-count"),round:document.querySelector(".round"),playerRound:document.getElementById("playerRound"),yourTurn:document.getElementById("yourTurn"),playerName:document.querySelector(".playerName"),resetBtn:document.querySelector(".reset"),addBtn:document.querySelector(".add"),readyButton:document.querySelector(".readyBtn")}}_bindEvents(){this.elements.addBtn.addEventListener("click",()=>this.handleAddWord()),this.elements.resetBtn.addEventListener("click",()=>this.handleReset()),this.elements.readyButton.addEventListener("click",()=>this.handleReveal()),this.elements.wordInput.addEventListener("keydown",e=>this.handleEnterKey(e))}clearDisplay(){this.elements.ulWordlist.replaceChildren()}showDisplayContainer(){this.elements.displayPanel.style.opacity="100%"}hideDisplayContainer(){this.elements.displayPanel.style.opacity="0%"}hideInput(){this.elements.inputContainer.style.display="none"}showInput(){this.elements.inputContainer.style.display="block"}displayWord(e,t,n,s,r){const h=new d(e,t,s,r,this.handleRemoveLastWord.bind(this),n).createWord();this.elements.ulWordlist.appendChild(h)}displayMessage(e){this.elements.wordInput.value="",this.elements.errorDiv.textContent=e,this.elements.errorDiv.classList.add("active"),setTimeout(()=>errorDiv.classList.remove("active"),4e3)}displayWordcount(e,t){this.elements.countDiv.textContent=`Round: ${e} / ${t}`,this.elements.countDiv.style.color=e===t?"var(--error)":"var(--accent)"}displayProgress(e){this.elements.progressDiv.style.width=`${e}%`}displayPlayerName(e){this.elements.playerName.textContent=e.username,this.elements.playerName.style.backgroundColor=e.color}hidePlayername(){}showFinishInfo(){this.elements.round.textContent="Phrase Terminée",this.elements.playerName.classList.add("hidden"),this.elements.yourTurn.textContent="Cliquez sur Ready pour continuer"}displayReadyButton(){this.elements.readyButton.classList.add("show")}displayRoundType(e){this.elements.round.textContent=e,this.elements.wordInput.placeholder=`Entrer un${e.toLowerCase()==="circonstance"?"e":""} ${e}`}displayFinalPhrase(e){this.elements.readyButton.classList.remove("show"),this.clearDisplay(),e.forEach((t,n)=>{setTimeout(()=>{const s=document.createElement("li");s.textContent=t.word,console.log("displayFinalPhrase, player:",t.player),s.style.backgroundColor=t.player.color,s.classList.add("enter"),this.elements.ulWordlist.append(s)},1e3*n)})}disableInput(){this.elements.wordInput.disabled=!0,this.elements.addBtn.disabled=!0,this.elements.addBtn.style.backgroundColor="lightgrey"}enableInput(){this.elements.wordInput.disabled=!1,this.elements.addBtn.disabled=!1,this.elements.addBtn.style.backgroundColor="var(--neutral)"}resetView(){this.elements.readyButton.classList.remove("show"),this.elements.playerName.classList.remove("hidden"),this.elements.yourTurn.textContent=", à ton tour!",this.elements.wordInput.value="",this.enableInput()}onAddWord(e){this._onAddWordCallback=e}onReset(e){this._onResetCallback=e}onReveal(e){this._onRevealCallback=e}onDeleteWord(e){this._onDeleteWordCallback=e}handleAddWord(){const e=this.elements.wordInput.value.trim(),t=this.elements.wordInput;!e||e==""||(this._onAddWordCallback&&this._onAddWordCallback(e),t.focus())}handleEnterKey(e){e.key==="Enter"&&(e.preventDefault(),this.handleAddWord())}handleRemoveLastWord(){this._onDeleteWordCallback&&this._onDeleteWordCallback()}handleReset(){this._onResetCallback&&this._onResetCallback(),this.resetView()}handleReveal(){if(this._onRevealCallback){const e=this._onRevealCallback();this.displayFinalPhrase(e)}}}class y{constructor(){this.setupContainer=document.querySelector(".setupContainer"),this.gameContainer=document.querySelector(".gameContainer"),this.playerInput=document.querySelector(".playerInput"),this.addPlayer=document.querySelector(".addPlayer"),this.onHandleAddPlayer=null,this.players=[],this.unusedColors=[...a.colors],this.usedColors=[],this._bindEvents()}_bindEvents(){this.addPlayer.addEventListener("click",()=>this.handleAddPlayer()),this.playerInput.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),this.handleAddPlayer())})}show(){this.setupContainer.style.display="block",this.gameContainer.style.display="none"}hide(){this.setupContainer.style.display="none",this.gameContainer.style.display="block",this.playerList=[]}renderPlayers(e){const t=document.getElementById("playerList");t.innerHTML="",e.forEach(n=>{const s=document.createElement("li");s.textContent=n.username,s.classList.add("playerLi"),s.style.background=n.color,t.append(s)})}onStartGame(e){document.querySelector(".startGame").addEventListener("click",()=>{const n=this.getConfiguration();e(n)})}handleAddPlayer(){const e=this.playerInput.value.trim();if(!e||e=="")return;const t=this.assignColor(e);t&&(this.players.push(t),this.renderPlayers(this.players),this.playerInput.value="",this.unusedColors.length==0&&(this.playerInput.disabled=!0,this.addPlayer.disabled=!0))}assignColor(e){if(this.unusedColors.length==0)return alert("Nombre de joueurs maximum atteint"),this.playerInput.value="",!1;const t=this.unusedColors.pop(),n={username:e,color:t};return this.usedColors.push(t),n}getConfiguration(){return{players:this.players,rounds:a.rounds}}}class w{constructor(){this.setupView=new y,this.gameModel=null,this.gameView=null,this.currentConfig={...a},this.initSetup()}initSetup(){this.setupView.show(),this.setupView.onStartGame(e=>{this.startGame(e)})}startGame(e){if(e.players<2){alert("Minimum number of players: 2");return}this.setupView.hide(),this.gameModel=new p(e),this.gameView=new m,this.initGameListeners(),this._updateGameView()}initGameListeners(){this.gameView.onAddWord(e=>this.handleAddWord(e)),this.gameView.onReset(()=>this.handleReset()),this.gameView.onReveal(()=>this.handleReveal()),this.gameView.onDeleteWord(()=>this.handleRemoveLastWord())}_updateGameView(){this.gameView.clearDisplay();const e=this.gameModel.getState();console.log("state:",e),this.gameView.displayWordcount(e.wordCount,e.maxWords),this.gameView.displayProgress(e.progress);let t=e.currentRound,n=e.currentPlayer;e.isCompleted&&(this.gameView.hideInput(),t="Fin"),this.gameView.displayRoundType(t),this.handlePlayerDisplay(n),e.wordCount>0&&(this.gameView.showDisplayContainer(),e.words.forEach((s,r)=>{this.gameView.displayWord(s.word,s.type,s.player,r,e.words.length)})),e.isCompleted?(this.gameView.disableInput(),this.gameView.displayReadyButton()):this.gameView.resetView()}_updateSetupView(){const e=this.gameModel.getState();this.setupView.renderPlayers(e.players)}handleAddWord(e){this.gameModel.addWord(e)||window.alert("Impossible d'ajouter le mot"),this._updateGameView()}handleRemoveLastWord(){this.gameModel.removeLastWord(),this.gameView.showInput(),this._updateGameView()}handleAddPlayer(e){success=this.gameModel.addPlayer(e),success||window.alert("Impossible d'ajouter le joueur"),this._updateSetupView()}handleReset(){this.gameModel.reset(),this.gameView.showInput(),this.gameView.hideDisplayContainer(),this._updateGameView()}handleReveal(){return this.gameModel.words}handlePlayerDisplay(e){this.gameModel.isGameCompleted()?this.gameView.showFinishInfo():this.gameView.displayPlayerName(e)}}new w;
